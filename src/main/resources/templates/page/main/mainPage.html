<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>mainPage</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6117695a060f0644636d10eec6c83951&libraries=services"></script>

    <style>
        body {
            height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #map {
            width: 100%;
            height: 100%;
            /*width: 40%;*/
            /*height: 40%;*/
            border: 2px solid black;
        }
        table {
            width: 80%;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script th:inline="javascript">
        var dataList = [[${dataList}]];
        var markers = []; // 배열로 마커 정보 저장

        function addMarkers(map) {
            var imageGreen = /*[[@{/green.png}]]*/ '';
            var imageOrange = /*[[@{/orange.png}]]*/ '';
            var imageRed = /*[[@{/red.png}]]*/ '';
            var imageParking = /*[[@{/parking.png}]]*/ '';

            var imageSize = new kakao.maps.Size(10, 10);

            for (var i = 0; i < dataList.length; i++) {
                var markerImage;
                if (dataList[i].parkingColor === 'green') {
                    markerImage = new kakao.maps.MarkerImage(imageGreen, imageSize);
                } else if (dataList[i].parkingColor === 'orange') {
                    markerImage = new kakao.maps.MarkerImage(imageOrange, imageSize);
                } else if (dataList[i].parkingColor === 'red') {
                    markerImage = new kakao.maps.MarkerImage(imageRed, imageSize);
                } else {
                    markerImage = new kakao.maps.MarkerImage(imageParking, imageSize);
                }

                var marker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(dataList[i].parkingLat, dataList[i].parkingLon),
                    title: dataList[i].parkingName,
                    image: markerImage
                });

                // 클릭 이벤트 핸들러
                kakao.maps.event.addListener(marker, 'click', (function(data) {
                    return function() {
                        console.log("Parking Name:", data.parkingName);
                        console.log("Latitude:", data.parkingLat);
                        console.log("Longitude:", data.parkingLon);
                        console.log("Color:", data.parkingColor);
                        console.log("markers:", markers);
                    };
                })(dataList[i]));

                markers.push(marker); // 마커 정보 배열에 추가
            }
        }

        if (dataList.length === 0) {
            alert("No data available.");
            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(35.416362, 127.390405),
                level: 7
            };
            const map = new kakao.maps.Map(container, options);
        } else {
            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(35.416362, 127.390405),
                level: 7
            };
            const map = new kakao.maps.Map(container, options);

            addMarkers(map);
        }
    </script>
</body>
</html>